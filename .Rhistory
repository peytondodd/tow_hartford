pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
?get_map
hartbox <- make_bbox(lon = 41.719956, lat = -72.637696, f = .1)
hartbox
hartbox <- make_bbox(lon = tows_no_na$tow_lon, lat =tows_no_na$tow_lat, f = .1)
hartbox
hart_map <- get_map(location = hartbox, maptype = "roadmap", source = "OpenStreetMap")
hart_map <- get_map(location = hartbox, maptype = "roadmap", source = "osm")
hart_map
pm_ct <- ggpmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="deepskyblue2", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
pm_ct <- ggpmap(hart_map)
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="deepskyblue2", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="deepskyblue2", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
#pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
3000/10
*12
300*12
300*4
3600-1200
3600-1500
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="deepskyblue2", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
hart_map <- get_map(location = hartbox, maptype = "roadmap", source = "google")
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="deepskyblue2", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
#pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
#pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
#pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="deepskyblue2", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
#pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
#pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
#pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="yellow", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
#pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
#pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
#pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="green", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
#pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
pm_ct <- ggmap(hart_map)
pm_ct <- pm_ct + stat_density2d(data = tows_no_na, show.legend=F, aes(x=tow_lon, y=tow_lat, fill=..level.., alpha=..level..),  geom="polygon",size=.5,bins=10)
#pm_ct <- pm_ct + geom_polygon(data = joined_tracts2, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.2)
#pm_ct <- pm_ct + geom_polygon(data = town_borders, aes(x=long, y=lat, group=group), fill=NA, color = "black", size=0.4)
#pm_ct <- pm_ct + geom_polygon(data = ct_only, aes(x=long, y=lat, group=group), fill="seagreen2", color = "gray93", size=0.2)
#pm_ct <- pm_ct + gg_circle(r=9, xc=-73, yc=42, color="white", fill=NA, alpha=0.2, size=40)
pm_ct <- pm_ct + scale_fill_gradient(low="purple", high="firebrick1", name="Distribution")
#pm_ct <- pm_ct + scale_fill_discrete()
#extra_lat <- c(46.358685, 35.872715)
#extra_lon <- c(-64.209938, -79.735653)
#pm_ct <- pm_ct + theme(legend.position="top",  legend.key = element_blank())
pm_ct <- pm_ct + coord_fixed()
pm_ct <- pm_ct + theme_nothing(legend=TRUE)
pm_ct <- pm_ct + labs(x=NULL, y=NULL, title="Where tow yards target")
#pm_ct <- pm_ct + facet_wrap(~Tow_Firm)
#pm_ct <- pm_ct + theme(text = element_text(size=15), panel.background = element_rect(fill = 'gray93', color=NA))
pm_ct <- pm_ct + theme(plot.title=element_text(face="bold", hjust=.4))
pm_ct <- pm_ct + theme(plot.subtitle=element_text(face="italic", size=9, margin=margin(l=20)))
pm_ct <- pm_ct + theme(plot.caption=element_text(size=12, margin=margin(t=12), color="#7a7d7e", hjust=0))
#pm_ct <- pm_ct + theme(legend.key.size = unit(1, "cm"))
pm_ct
tows <- tows_no_na[c("tow_lon", "tow_lat")]
View(tows)
tows_leaf <- tows_no_na[c("tow_lon", "tow_lat")]
tows_leaf$lon_lat <- past0(tows_leaf$tow_lon, ", ", tows_leaf$tow_lat)
tows_leaf$lon_lat <- paste0(tows_leaf$tow_lon, ", ", tows_leaf$tow_lat)
View(tows_leaf)
tows_leaf <- tows_no_na[c("tow_lon", "tow_lat")]
tows_leaf <- tows_leaf %>%
group_by(tow_lon, tow_lat) %>%
summarise(count=n())
tows <- read.csv("data/tows.csv", stringsAsFactors=F)
# Cleaning the data
## Figure out tow firm and address based on phone number
### Subset dataframe of complete data
tows_sub <- subset(tows, Tow_Firm!="")
tows_sub <- subset(tows_sub, !duplicated(Tow_Firm))
tows_sub <- subset(tows_sub, Tow_Firm!="CROSS COUNTRY AUTO")
nrow(tows_sub)
#### There are 21 Towing Yards in Hartford
#### Geolocate tow firms
geo <- geocode(location = tows_sub$Tow_Firm_Address, output="latlon", source="google")
tows_sub <- cbind(tows_sub, geo)
color <- data.frame("#29e908",
"#0a5cee",
"#8d480c",
"#8edeb7",
"#c9e746",
"#96bab2",
"#0fe5a2",
"#6a5c5b",
"#19cdfd",
"#279fe6",
"#7ac150",
"#660e6e",
"#095a21",
"#dfe142",
"#786839",
"#f5657c",
"#4decd2",
"#4eb06f",
"#fdc200",
"#08d479",
"#b2cca8")
color <- data.frame(t(color))
rownames(color) <- NULL
tows_sub <- cbind(tows_sub, color)
#### Delete Tow_Firm and Tow_Firm_Address columns in original dataframe
tows <- tows[,-3]
tows <- tows[,-3]
#### Prep dataframe for joining
tows_sub <- tows_sub[c("Tow_Firm", "Tow_Firm_Address", "Tow_Firm_Phone", "lon", "lat", "t.color.")]
#### Join the dataframes
tows <- left_join(tows, tows_sub)
#### Clean up time and dates
tows$Date <- ymd(tows$Date)
tows$Time <- hms(tows$Time)
tows$created_at <- ymd_hms(tows$created_at)
tows$created_at <- ymd_hms(tows$updated_at)
tows$removed_at <- ymd_hms(tows$removed_at)
#### Prepping Lat/Lon
tows$tow_lon <- gsub(",.*", "", tows$geom)
tows$tow_lat <- gsub(".*,", "", tows$geom)
tows_leaf$extra <- "222"
tows <- read.csv("data/tows.csv", stringsAsFactors=F)
# Cleaning the data
## Figure out tow firm and address based on phone number
### Subset dataframe of complete data
tows_sub <- subset(tows, Tow_Firm!="")
tows_sub <- subset(tows_sub, !duplicated(Tow_Firm))
tows_sub <- subset(tows_sub, Tow_Firm!="CROSS COUNTRY AUTO")
nrow(tows_sub)
#### There are 21 Towing Yards in Hartford
#### Geolocate tow firms
geo <- geocode(location = tows_sub$Tow_Firm_Address, output="latlon", source="google")
tows_sub <- cbind(tows_sub, geo)
color <- data.frame("#29e908",
"#0a5cee",
"#8d480c",
"#8edeb7",
"#c9e746",
"#96bab2",
"#0fe5a2",
"#6a5c5b",
"#19cdfd",
"#279fe6",
"#7ac150",
"#660e6e",
"#095a21",
"#dfe142",
"#786839",
"#f5657c",
"#4decd2",
"#4eb06f",
"#fdc200",
"#08d479",
"#b2cca8")
color <- data.frame(t(color))
rownames(color) <- NULL
tows_sub <- cbind(tows_sub, color)
#### Delete Tow_Firm and Tow_Firm_Address columns in original dataframe
tows <- tows[,-3]
tows <- tows[,-3]
#### Prep dataframe for joining
tows_sub <- tows_sub[c("Tow_Firm", "Tow_Firm_Address", "Tow_Firm_Phone", "lon", "lat", "t.color.")]
#### Join the dataframes
tows <- left_join(tows, tows_sub)
#### Clean up time and dates
tows$Date <- ymd(tows$Date)
tows$Time <- hms(tows$Time)
tows$created_at <- ymd_hms(tows$created_at)
tows$created_at <- ymd_hms(tows$updated_at)
tows$removed_at <- ymd_hms(tows$removed_at)
#### Prepping Lat/Lon
tows$tow_lon <- gsub(",.*", "", tows$geom)
tows$tow_lat <- gsub(".*,", "", tows$geom)
tows_no_na <- subset(tows, !is.na(tow_lat))
tows_no_na$distance <- distm(c(tows_no_na$lat, tows_no_na$lon), c(tows_no_na$tow_lat, tows_no_na$tow_lon), fun=distHaversine)
tows_leaf <- tows_no_na[c("tow_lon", "tow_lat")]
tows_leaf$extra <- "222"
write.csv(tows_leaf, "tows_leaf.csv")
tows_leaf <- tows_leaf %>%
group_by(tow_lon, tow_lat) %>%
summarise(count=n())
the_js <- "var addressPoints==[
"
for (i in nrow(tows_leaf)) {
the_js <- paste0("[", tows_leaf$tow_lon[i], ", ", tows_leaf$tow_lat[i], ", \"" , tows_leaf$count[i], "\"],")
}
write(the_js, "the_js.js")
the_js <- "var addressPoints==[
"
for (i in nrow(tows_leaf)) {
the_js <- paste0(the_js, "[", tows_leaf$tow_lon[i], ", ", tows_leaf$tow_lat[i], ", \"" , tows_leaf$count[i], "\"],")
}
write(the_js, "the_js.js")
the_js <- "var addressPoints==[
"
for (i in nrow(tows_leaf)) {
the_js <- paste0(the_js, "[", tows_leaf$tow_lon[i], ", ", tows_leaf$tow_lat[i], ", \"" , tows_leaf$count[i], "\"],")
}
write(the_js, "the_js.js")
the_js <- "var addressPoints==[
"
for (i in nrow(tows_leaf)) {
print(i)
the_js <- paste0(the_js, "[", tows_leaf$tow_lon[i], ", ", tows_leaf$tow_lat[i], ", \"" , tows_leaf$count[i], "\"],")
}
the_js <- "var addressPoints==[
"
for (i in 1:nrow(tows_leaf)) {
print(i)
the_js <- paste0(the_js, "[", tows_leaf$tow_lon[i], ", ", tows_leaf$tow_lat[i], ", \"" , tows_leaf$count[i], "\"],")
}
write(the_js, "the_js.js")
the_js <- "var addressPoints==[
"
for (i in 1:nrow(tows_leaf)) {
print(i)
the_js <- paste0(the_js, "[", tows_leaf$tow_lat[i], ", ", tows_leaf$tow_lon[i], ", \"" , tows_leaf$count[i], "\"],")
}
the_js <- paste0(the_js, ";")
write(the_js, "the_js.js")
avg_miles
kable(avg_miles)
print(m)
leaflet(tows) %>% addTiles('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', attribution='Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>') %>%
setView(-72.690940, 41.751426, zoom = 12) %>%
addCircles(~lon, ~lat, popup=tows$Make, weight = 3, radius=40,
color="#ffa500", stroke = TRUE, fillOpacity = 0.8) %>%
addLegend("bottomright", colors= "#ffa500", labels="Towed'", title="In Hartford")
tm_ct <- ggplot() +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5)
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed from", fill="")
print(tm_ct)
town_borders
tm_ct <- ggplot() +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5)
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
tm_ct <- ggplot() +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
tm_ct <- ggplot() +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
library(dplyr)
library(lubridate)
library(leaflet)
library(ggmap)
library(knitr)
library(stringr)
library(geosphere)
library(ggplot2)
require(ggmap)
require(scales)
library(sp)
require(rgdal)
require(maptools)
tm_ct <- ggplot() +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
tm_ct <- ggmap(hart_map) +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
hartbox <- make_bbox(lon = tows_no_na$tow_lon, lat =tows_no_na$tow_lat, f = .2)
hartbox <- make_bbox(lon = tows_no_na$tow_lon, lat =tows_no_na$tow_lat, f = .2)
hartbox <- make_bbox(lon = tows$tow_lon, lat =tows$tow_lat, f = .2)
hart_map <- get_map(location = "Hartford", maptype = "roadmap", source = "google")
tm_ct <- ggmap(hart_map) +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
hart_map <- get_map(location = "Hartford", zoom=11, maptype = "roadmap", source = "google")
tm_ct <- ggmap(hart_map) +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
hart_map <- get_map(location = "Hartford", zoom=12, maptype = "roadmap", source = "google")
tm_ct <- ggmap(hart_map) +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
hart_map <- get_map(location = "Hartford", zoom=13, maptype = "roadmap", source = "google")
# Subset the town borders to just Hamden since that's the department we're looking at
town_borders <- subset(townborders, id=="Hartford")
tm_ct <- ggmap(hart_map) +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
hart_map <- get_map(location = "Hartford", zoom=12, maptype = "roadmap", source = "google")
townborders <- readOGR(dsn="maps", layer="ctgeo")
townborders_only <- townborders
townborders<- fortify(townborders, region="NAME10")
# Subset the town borders to just Hamden since that's the department we're looking at
town_borders <- subset(townborders, id=="Hartford")
tm_ct <- ggmap(hart_map) +
geom_point(data=tows, aes(x=lon, y=lat), color="red", size=5, alpha=0.5) +
#geom_polygon(data = total_map, aes(x=long, y=lat, group=group, fill=total), color = "black", size=0.2) +
geom_polygon(data = town_borders, aes(x=long, y=lat, group=group, fill=total), color = "black", fill=NA, size=0.5) +
coord_map() +
scale_fill_distiller(type="seq", trans="reverse", palette = "Reds", breaks=pretty_breaks(n=10)) +
theme_nothing(legend=TRUE) +
labs(title="Where vehicles are towed to", fill="")
print(tm_ct)
